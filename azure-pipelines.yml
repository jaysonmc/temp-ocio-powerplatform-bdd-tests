trigger:
- 'importing-from-azure'

parameters:
- name: env
  displayName: 'Target env'
  default: dev
  values:
  - dev
  - test
  - prod
- name: LOAD_HOST
  displayName: Load testing host
  default: 'https://workplace.alpha.canada.ca'
  values:
  - 'https://workplace.alpha.canada.ca'
  - 'https://gcr2wp-dev.powerappsportals.com'
  - 'https://uat.workplace-milieudetravail.gc.ca/en-US'
- name: HAIBUN_ENVC
  displayName: USER_EMAIL and USER_PASSWORD pairs

pool:
  vmImage: 'ubuntu-latest'


stages:
- stage: ConnectivityTest
  displayName: ConnectivityTest
  jobs:
  - job: connectivity
    pool:
      vmImage: 'ubuntu-latest'
    steps:
      - bash: |
          sudo apt-get install -y curl
        displayName: installCurl
      - bash: |
          curl -v $(LOAD_HOST)
        displayName: curl verbose

  - job: playwright
    pool:
      vmImage: 'ubuntu-latest'
    container:
      image: mcr.microsoft.com/playwright:focal
    steps:
      - checkout: self

      - task: Npm@1
        inputs:
          command: 'install'
        displayName: 'installing dependencies'

      - task: Npm@1
        inputs:
          command: 'custom'
          customCommand: 'run test-lang'
        displayName: 'Running playwright tests'


